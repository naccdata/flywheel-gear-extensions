# CSV to JSON Transformer

Gear reads a tabular (CSV) file of form data with one participant visit per row and creates a JSON file for each visit performing column transformations depending on the form type (or `module`).

The JSON file will be added to a subject/session/acquisition for the participant determined by the `module` value as follows,
- UDS
    - subject - [`naccid`]
    - session - FORMS-VIST-[`visitnum`]
    - acquisition - [`module`]
- FTLD
    - subject - [`naccid`]
    - session - FORMS-VIST-[`visitnum`]
    - acquisition - [`module`]
- LBD
    - subject - [`naccid`]
    - session - FORMS-VIST-[`visitnum`]
    - acquisition - [`module`]
- Milestone
    - subject - [`naccid`]
    - session - MILESTONE-[`visitdate`]
    - acquisition - [`module`]
- NP
    - subject - [`naccid`]
    - session - NP-RECORD-[`visitdate`]
    - acquisition - [`module`]
    
JSON filename: [subject]-[session]-[acquisition].json
(e.g. NACC000123-FORMS-VISIT-05-UDS.json)

General Transformations
- normalizing visit date to `YYYY-MM-DD` format
  
UDS Transformations
- Remove C2 only fields from C2T submission and vice versa

LBD Transformations   
- Remove v3.0 only fields from v3.1 submission and vice versa

### Environment
This gear uses the AWS SSM parameter store, and expects that AWS credentials are available in environment variables (AWS_SECRET_ACCESS_KEY, AWS_ACCESS_KEY_ID, AWS_DEFAULT_REGION) within the Flywheel runtime.

### Inputs
This gear will be triggered on the CSV file generated by  the [Identifier Lookup](../identifier_lookup/index.md) gear.

### Configs
Gear configs are defined in [manifest.json](../../gear/csv_subject_splitter/src/docker/manifest.json).